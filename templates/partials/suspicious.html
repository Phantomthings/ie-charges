<div class="panel">
    <div class="panel-header">
        <div>
            <div class="panel-title">Transactions suspectes (&lt; 1 kWh)</div>
            <div class="panel-subtitle">Liste des charges dont l'énergie consommée est inférieure à 1 kWh</div>
        </div>
        {% if rows %}
        <div class="pill pill-neutral">{{ rows|length }} occurrence{{ 's' if rows|length > 1 else '' }}</div>
        {% endif %}
    </div>

    <style>
        .panel {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            padding: 1rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .panel-title {
            font-weight: 700;
            color: var(--color-text);
            font-size: 1.05rem;
        }
        .panel-subtitle {
            color: var(--color-text-muted);
            font-size: 0.9rem;
        }
        .pill {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.75rem;
            border-radius: 999px;
            font-weight: 600;
            font-size: 0.85rem;
            border: 1px solid var(--color-border);
            background: var(--color-bg);
            color: var(--color-text);
        }
        .pill-neutral {
            background: var(--color-info-light);
            border-color: rgba(59, 130, 246, 0.2);
            color: var(--color-info);
        }
        .table-wrapper-suspicious {
            overflow: auto;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            max-height: 420px;
        }
        .suspicious-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 920px;
        }
        .suspicious-table th {
            position: sticky;
            top: 0;
            background: var(--color-surface);
            text-align: left;
            padding: 0.55rem;
            font-size: 0.85rem;
            color: var(--color-text-muted);
            border-bottom: 1px solid var(--color-border);
            white-space: nowrap;
        }
        .suspicious-table td {
            padding: 0.55rem;
            border-bottom: 1px solid var(--color-border);
            font-size: 0.9rem;
            color: var(--color-text);
            vertical-align: middle;
        }
        .suspicious-table tbody tr:nth-child(even) {
            background: #f9fafb;
        }
        .muted-text { color: var(--color-text-muted); }
        .link-cell a {
            color: var(--color-info);
            text-decoration: none;
        }
        .link-cell a:hover { text-decoration: underline; }
    </style>

    {% if rows %}
    <div class="table-wrapper-suspicious">
        <table class="suspicious-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>ID</th>
                    <th>Site</th>
                    <th>PDC</th>
                    <th>MAC</th>
                    <th>Véhicule</th>
                    <th>Début</th>
                    <th>Fin</th>
                    <th>Énergie (kWh)</th>
                    <th>SOC début</th>
                    <th>SOC fin</th>
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                <tr>
                    <td class="muted-text">{{ row.rank }}</td>
                    <td class="link-cell">
                        {% if row.id %}
                            <a href="{{ row.url }}" target="_blank">{{ row.id }}</a>
                        {% else %}
                            <span class="muted-text">-</span>
                        {% endif %}
                    </td>
                    <td>{{ row.site }}</td>
                    <td>{{ row.pdc }}</td>
                    <td>{{ row.mac }}</td>
                    <td>{{ row.vehicle }}</td>
                    <td>{{ row.start }}</td>
                    <td>{{ row.end }}</td>
                    <td>{{ row.energy }}</td>
                    <td>{{ row.soc_start }}</td>
                    <td>{{ row.soc_end }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">✅</div>
        <div>Aucune transaction suspecte sur ce périmètre.</div>
    </div>
    {% endif %}
</div>
